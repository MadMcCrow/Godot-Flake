name: 'Update Flake.Lock'

on:
  push:
    branches:
      - main
  schedule:
    - cron: '0 3 * * *'

jobs:

  # nix flake update
  update-flake-reuse:
    uses: MadMcCrow/flake-github-workflow/.github/workflows/update_flake.yml@main
    with:
      git_email: noe.perard_git@gmail.com
      git_user:  github-action-bot
      cachix-repository: godot-flake
      jq-command:  '.packages["x86_64-linux"] | keys - ["default"]'
    secrets:
      CACHIX_SIGNING_KEY: ${{ secrets.CACHIX_SIGNING_KEY }}

  # pr
  #pull-request-reuse:
  #  needs: [update-flake-reuse]
  #  uses: MadMcCrow/flake-github-workflow/.github/workflows/pull_request.yaml@main
  #  with:
  #    commit:    'update : flake.lock'
  #    pr_title:  ':robot: flake update'

  # clean up (do it at the end)
  clean-workflow-reuse:
    # needs: [ update-flake-reuse]
    uses: MadMcCrow/flake-github-workflow/.github/workflows/clean_workflows.yml@main
    with:
      repository: ${{ github.repository }}